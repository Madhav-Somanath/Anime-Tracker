import os
import forms
from app import app
from flask import render_template, request
from utils_database import add_anime_to_database, get_all_anime_from_database, update_anime_in_database, delete_anime_from_database
from utils_scrape import scrape_data, check_new_episodes
from utils_torrent import download_torrent, add_torrent


TEMP_SITE_DATA = [('[HorribleSubs] Kanojo, Okarishimasu - 06 [720p].mkv', '1271497'), ('[HorribleSubs] Enen no Shouboutai S2 - 07 [720p].mkv', '1271478'), ('[HorribleSubs] Peter Grill to Kenja no Jikan - 06 [720p].mkv', '1271424'), ('[HorribleSubs] Shokugeki no Soma S5 - 07 [720p].mkv', '1271416'), ('[HorribleSubs] Dokyuu Hentai HxEros - 07[720p].mkv', '1271409'), ('[HorribleSubs] Toaru Kagaku no Railgun T - 19 [720p].mkv', '1271397'), ('[HorribleSubs] Uzaki-chan wa Asobitai! - 06 [720p].mkv', '1271342'), ('[HorribleSubs] Appare-Ranman! - 07 [720p].mkv', '1271340'), ('[HorribleSubs] Yahari Ore no Seishun Love Come wa Machigatteiru Kan - 06 [720p].mkv', '1271166'), ('[HorribleSubs] No Guns Life - 18 [720p].mkv', '1271161'), ('[HorribleSubs] Fugou Keiji Balance - UNLIMITED - 05 [720p].mkv', '1271151'), ('[HorribleSubs] Gundam Build Divers Re-RISE - 24 [720p].mkv', '1271102'), ('[HorribleSubs] Koi to Producer - Evol x Love - 05 [720p].mkv', '1270951'), ('[HorribleSubs] Re Zero karaHajimeru Isekai Seikatsu - 31 [720p].mkv', '1270923'), ('[HorribleSubs] Deca-Dence - 06 [720p].mkv', '1270914'), ('[HorribleSubs] Gibiate - 05 [720p].mkv', '1270896'), ('[HorribleSubs] Ahiru no Sora - 43 [720p].mkv', '1270856'), ('[HorribleSubs] Houkago Teibou Nisshi - 06 [720p].mkv', '1270655'), ('[HorribleSubs] Umayon - 06 [720p].mkv', '1270636'), ('[HorribleSubs] Muhyo to Rouji no Mahouritsu Soudan Jimusho - 18 [720p].mkv', '1270592'), ('[HorribleSubs] Black Clover - 138 [720p].mkv', '1270589'), ('[HorribleSubs] Shadowverse - 18 [720p].mkv', '1270578'), ('[HorribleSubs] Fruits Basket S2 (2019) - 19 [720p].mkv', '1270457'), ('[HorribleSubs] The God of High School - 06 [720p].mkv', '1270395'), ('[HorribleSubs] Ninja Collection - 05 [720p].mkv', '1270256'), ('[HorribleSubs] Monster Musume no Oisha-san -05 [720p].mkv', '1270178'), ('[HorribleSubs] Boruto - Naruto Next Generations - 160 [720p].mkv', '1270103'), ('[HorribleSubs] Digimon Adventure (2020) - 10 [720p].mkv', '1270004'), ('[HorribleSubs] One Piece - 936 [720p].mkv', '1269994'), ('[HorribleSubs] Healin Good Precure - 19 [720p].mkv', '1269985'), ('[HorribleSubs] Sword Art Online - Alicization - War of Underworld - 17 [720p].mkv', '1269818'), ('[HorribleSubs] Maou Gakuin no Futekigousha - 06 [720p].mkv', '1269807'), ('[HorribleSubs] Lapis ReLiGHTs - 06 [720p].mkv', '1269771'), ('[HorribleSubs] Major 2nd S2 - 12 [720p].mkv', '1269720'), ('[HorribleSubs] Kanojo, Okarishimasu - 05 [720p].mkv', '1269527'), ('[HorribleSubs] Enen no Shouboutai S2 - 06 [720p].mkv', '1269506'), ('[HorribleSubs] Bungo to Alchemist - Shinpan no Haguruma - 13 [720p].mkv', '1269495'), ('[HorribleSubs] Peter Grill to Kenja no Jikan - 05 [720p].mkv', '1269478'), ('[HorribleSubs] Shokugeki no Soma S5 - 06 [720p].mkv', '1269468'), ('[HorribleSubs] Dokyuu Hentai HxEros - 06 [720p].mkv', '1269464'), ('[HorribleSubs] Toaru Kagaku no Railgun T - 18 [720p].mkv', '1269453'), ('[HorribleSubs] Uzaki-chan wa Asobitai! - 05 [720p].mkv', '1269381'), ('[HorribleSubs] Appare-Ranman! - 06 [720p].mkv', '1269376'), ('[HorribleSubs] Yahari Ore no Seishun Love Come wa Machigatteiru Kan - 05 [720p].mkv', '1269204'), ('[HorribleSubs] No Guns Life - 17 [720p].mkv', '1269197'), ('[HorribleSubs] Fugou Keiji Balance - UNLIMITED - 04 [720p].mkv', '1269188'), ('[HorribleSubs] Gundam Build Divers Re-RISE - 23 [720p].mkv', '1269129'), ('[HorribleSubs] Koi to Producer - Evol x Love - 04 [720p].mkv', '1268959'), ('[HorribleSubs] Re Zero kara Hajimeru Isekai Seikatsu - 30 [720p].mkv', '1268918'), ('[HorribleSubs] Deca-Dence - 05 [720p].mkv', '1268916'), ('[HorribleSubs] Gibiate - 04 [720p].mkv', '1268908'), ('[HorribleSubs] Ahiru no Sora - 42 [720p].mkv', '1268870'), ('[HorribleSubs] Houkago Teibou Nisshi - 05 [720p].mkv', '1268623'), ('[HorribleSubs] Umayon - 05 [720p].mkv', '1268609'), ('[HorribleSubs] Muhyo to Rouji no Mahouritsu Soudan Jimusho - 17 [720p].mkv', '1268568'), ('[HorribleSubs] Black Clover - 137 [720p].mkv', '1268559'), ('[HorribleSubs] Shadowverse - 17 [720p].mkv', '1268550'), ('[HorribleSubs] Fruits Basket S2 (2019) - 18 [720p].mkv', '1268380'), ('[HorribleSubs] The God of High School - 05 [720p].mkv', '1268328'), ('[HorribleSubs] Ninja Collection - 04 [720p].mkv', '1268171'), ('[HorribleSubs] Monster Musume no Oisha-san - 04 [720p].mkv', '1268070'), ('[HorribleSubs] Boruto - Naruto Next Generations - 159 [720p].mkv', '1267971'), ('[HorribleSubs] Digimon Adventure (2020) - 09 [720p].mkv', '1267886'), ('[HorribleSubs] One Piece - 935 [720p].mkv', '1267872'), ('[HorribleSubs] Healin Good Precure - 18 [720p].mkv', '1267864'), ('[HorribleSubs] Sword Art Online - Alicization - War of Underworld - 16 [720p].mkv', '1267747'), ('[HorribleSubs] Maou Gakuin no Futekigousha - 05 [720p].mkv', '1267731'), ('[HorribleSubs] Lapis ReLiGHTs - 05 [720p].mkv', '1267681'), ('[HorribleSubs] Detective Conan - 977 [720p].mkv', '1267625'), ('[HorribleSubs] Major 2nd S2 - 11 [720p].mkv', '1267614'), ('[HorribleSubs] Kanojo, Okarishimasu - 04 [720p].mkv', '1267359'), ('[HorribleSubs] Enen no Shouboutai S2 - 05 [720p].mkv', '1267350'), ('[HorribleSubs] Bungo to Alchemist - Shinpan no Haguruma - 12 [720p].mkv', '1267335'), ('[HorribleSubs] Peter Grill to Kenja no Jikan - 04[720p].mkv', '1267321'), ('[HorribleSubs] Shokugeki no Soma S5 - 05 [720p].mkv', '1267312'), ('[HorribleSubs] Dokyuu Hentai HxEros - 05 [720p].mkv', '1267306'), ('[HorribleSubs] Toaru Kagaku no Railgun T - 17 [720p].mkv', '1267285'), ('[HorribleSubs] Uzaki-chan wa Asobitai! - 04 [720p].mkv', '1267235'), ('[HorribleSubs] Appare-Ranman! - 05 [720p].mkv', '1267232'), ('[HorribleSubs] Yahari Ore no Seishun Love Come wa Machigatteiru Kan - 04 [720p].mkv', '1267054'), ('[HorribleSubs] No Guns Life - 16 [720p].mkv', '1267052'), ('[HorribleSubs] Fugou Keiji Balance - UNLIMITED - 03 [720p].mkv', '1267042'), ('[HorribleSubs] Gundam Build Divers Re-RISE - 22 [720p].mkv', '1266970'), ('[HorribleSubs] Koi to Producer - Evol x Love - 03 [720p].mkv', '1266799'), ('[HorribleSubs] Re Zero kara Hajimeru Isekai Seikatsu -29 [720p].mkv', '1266766'), ('[HorribleSubs] Deca-Dence - 04 [720p].mkv', '1266761'), ('[HorribleSubs] Gibiate - 03 [720p].mkv', '1266749'), ('[HorribleSubs] Ahiru no Sora - 41 [720p].mkv', '1266701'), ("[HorribleSubs] Goblin Slayer - Goblin's Crown - 00 [720p].mkv", '1266573'), ('[HorribleSubs] Houkago Teibou Nisshi - 04 [720p].mkv', '1266497'), ('[HorribleSubs] Umayon - 04 [720p].mkv', '1266488'), ('[HorribleSubs] Muhyo to Rouji no Mahouritsu Soudan Jimusho - 16 [720p].mkv', '1266453'), ('[HorribleSubs] Black Clover - 136 [720p].mkv', '1266448'), ('[HorribleSubs] Shadowverse - 16 [720p].mkv', '1266435'), ('[HorribleSubs] Fruits Basket S2 (2019) - 17 [720p].mkv', '1266304'), ('[HorribleSubs] The God of High School - 04 [720p].mkv', '1266264'), ('[HorribleSubs] Ninja Collection - 03 [720p].mkv', '1266072'), ('[HorribleSubs] Monster Musume no Oisha-san - 03 [720p].mkv', '1265988'), ('[HorribleSubs] Boruto - Naruto Next Generations - 158 [720p].mkv', '1265906'), ('[HorribleSubs] Digimon Adventure (2020) - 08 [720p].mkv', '1265832'), ('[HorribleSubs] One Piece - 934 [720p].mkv', '1265828'), ('[HorribleSubs] Healin Good Precure - 17 [720p].mkv', '1265817'), ('[HorribleSubs] Sword Art Online - Alicization - War of Underworld - 15 [720p].mkv', '1265706'), ('[HorribleSubs] Maou Gakuin no Futekigousha - 04 [720p].mkv', '1265695'), ('[HorribleSubs] Lapis ReLiGHTs - 04 [720p].mkv', '1265644'), ('[HorribleSubs] Major 2nd S2 - 10 [720p].mkv', '1265602'),('[HorribleSubs] Kanojo, Okarishimasu - 03 [720p].mkv', '1265431'), ('[HorribleSubs] Enen no Shouboutai S2 - 04 [720p].mkv', '1265410'), ('[HorribleSubs] Bungo toAlchemist - Shinpan no Haguruma - 11 [720p].mkv', '1265394'), ('[HorribleSubs] Peter Grill to Kenja no Jikan - 03 [720p].mkv', '1265377'), ('[HorribleSubs] Shokugeki no Soma S5 - 04 [720p].mkv', '1265365'), ('[HorribleSubs] Dokyuu Hentai HxEros - 04 [720p].mkv', '1265360'), ('[HorribleSubs] Toaru Kagaku no Railgun T - 16 [720p].mkv', '1265346'), ('[HorribleSubs] Uzaki-chan wa Asobitai! - 03 [720p].mkv', '1265311'), ('[HorribleSubs] Appare-Ranman! - 04 [720p].mkv', '1265306'), ('[HorribleSubs] Yahari Ore no Seishun Love Come wa Machigatteiru Kan - 03 [720p].mkv', '1265168'), ('[HorribleSubs] No Guns Life - 15 [720p].mkv', '1265164'), ('[HorribleSubs] Gundam Build Divers Re-RISE - 21 [720p].mkv', '1265111'), ('[HorribleSubs] Koi to Producer - Evol x Love - 02 [720p].mkv', '1264939'), ('[HorribleSubs] Re Zero kara Hajimeru Isekai Seikatsu - 28 [720p].mkv', '1264917'), ('[HorribleSubs] Deca-Dence - 03 [720p].mkv', '1264914'), ('[HorribleSubs] Gibiate - 02 [720p].mkv', '1264905'), ('[HorribleSubs] Ahiru no Sora - 40 [720p].mkv', '1264848'), ('[HorribleSubs] Umayon - 03 [720p].mkv', '1264661'), ('[HorribleSubs] Muhyo to Rouji noMahouritsu Soudan Jimusho - 15 [720p].mkv', '1264618'), ('[HorribleSubs] Black Clover - 135 [720p].mkv', '1264615'), ('[HorribleSubs] Shadowverse - 15 [720p].mkv', '1264612'), ('[HorribleSubs] Fruits Basket S2 (2019) - 16 [720p].mkv', '1264437'), ('[HorribleSubs] The God of High School - 03 [720p].mkv', '1264371'), ('[HorribleSubs] Ninja Collection - 02 [720p].mkv', '1264202'), ('[HorribleSubs] Monster Musume no Oisha-san - 02 [720p].mkv', '1264121'), ('[HorribleSubs] Boruto - NarutoNext Generations - 157 [720p].mkv', '1264053'), ('[HorribleSubs] Digimon Adventure (2020) - 07 [720p].mkv', '1263980'), ('[HorribleSubs] One Piece - 933 [720p].mkv', '1263972'), ('[HorribleSubs] Healin Good Precure - 16 [720p].mkv', '1263959'), ('[HorribleSubs] Sword Art Online - Alicization - War of Underworld - 14 [720p].mkv', '1263821'), ('[HorribleSubs] Maou Gakuin no Futekigousha - 03 [720p].mkv', '1263806'), ('[HorribleSubs] Lapis ReLiGHTs - 03 [720p].mkv', '1263770'), ('[HorribleSubs] Detective Conan - 976 [720p].mkv', '1263732'), ('[HorribleSubs] Major 2nd S2 - 09 [720p].mkv', '1263722'), ('[HorribleSubs] Kanojo, Okarishimasu - 02 [720p].mkv', '1263551'), ('[HorribleSubs] Enen no Shouboutai S2 - 03 [720p].mkv', '1263537'), ('[HorribleSubs] Bungo to Alchemist - Shinpan no Haguruma - 10 [720p].mkv', '1263524'), ('[HorribleSubs] Peter Grill to Kenja no Jikan - 02 [720p].mkv', '1263503'), ('[HorribleSubs] Dokyuu Hentai HxEros - 03 [720p].mkv', '1263495'), ('[HorribleSubs] Shokugeki no Soma S5 - 03 [720p].mkv', '1263493'), ('[HorribleSubs] Yahari Ore no Seishun Love Come wa Machigatteiru Kan - 02 [720p].mkv', '1263440'), ('[HorribleSubs] Uzaki-chan wa Asobitai! - 02 [720p].mkv', '1263438'), ('[HorribleSubs] No Guns Life - 14 [720p].mkv', '1263204'), ('[HorribleSubs] Gundam Build Divers Re-RISE - 20 [720p].mkv', '1263145'), ('[HorribleSubs] Re Zero kara Hajimeru Isekai Seikatsu - Hyouketsu no Kizuna - 00 [720p].mkv', '1263016'), ('[HorribleSubs] Re Zero kara Hajimeru Isekai Seikatsu - Memory Snow - 00 [720p].mkv', '1263012'), ('[HorribleSubs] Koi to Producer - Evol x Love - 01 [720p].mkv', '1263001'), ('[HorribleSubs] Gibiate - 01 [720p].mkv', '1262999'), ('[HorribleSubs] Deca-Dence - 02 [720p].mkv', '1262916'), ('[HorribleSubs] Re Zero kara Hajimeru Isekai Seikatsu - 27 [720p].mkv', '1262912'), ('[HorribleSubs] Ahiru no Sora - 39 [720p].mkv', '1262864'), ('[HorribleSubs] Umayon - 02 [720p].mkv', '1262641'), ('[HorribleSubs] Muhyo to Rouji no Mahouritsu Soudan Jimusho - 14 [720p].mkv', '1262597'), ('[HorribleSubs] Black Clover - 134 [720p].mkv', '1262594'), ('[HorribleSubs] Shadowverse - 14 [720p].mkv', '1262591'), ('[HorribleSubs] Fruits Basket S2 (2019) - 15 [720p].mkv', '1262421'), ('[HorribleSubs] The God of High School - 02 [720p].mkv', '1262333'), ('[HorribleSubs] Ninja Collection - 01 [720p].mkv', '1262154'), ('[HorribleSubs] Boruto - Naruto Next Generations - 156 [720p].mkv', '1261990'), ('[HorribleSubs] Monster Musume no Oisha-san - 01 [720p].mkv', '1261966'), ('[HorribleSubs] Healin Good Precure - 15 [720p].mkv', '1261927'), ('[HorribleSubs] DigimonAdventure (2020) - 06 [720p].mkv', '1261908'), ('[HorribleSubs] One Piece - 932 [720p].mkv', '1261897'), ('[HorribleSubs] Sword Art Online - Alicization - War of Underworld - 13 [720p].mkv', '1261779'), ('[HorribleSubs] Maou Gakuin no Futekigousha - 02 [720p].mkv', '1261757'), ('[HorribleSubs] Lapis ReLiGHTs - 02 [720p].mkv', '1261721'), ('[HorribleSubs] Major 2nd S2 - 08 [720p].mkv', '1261678'), ('[HorribleSubs] Kanojo, Okarishimasu - 01 [720p].mkv', '1261470'), ('[HorribleSubs] Enen no Shouboutai S2 - 02 [720p].mkv', '1261448'), ('[HorribleSubs] Bungo to Alchemist - Shinpan no Haguruma - 09 [720p].mkv', '1261434'), ('[HorribleSubs] Peter Grill to Kenja no Jikan - 01 [720p].mkv', '1261405'), ('[HorribleSubs] Dokyuu Hentai HxEros - 02 [720p].mkv', '1261397'), ('[HorribleSubs] Yahari Ore no Seishun Love Come wa Machigatteiru Kan - 01 [720p].mkv', '1261395'), ('[HorribleSubs] Uzaki-chan wa Asobitai! - 01 [720p].mkv', '1261370'), ('[HorribleSubs] No Guns Life - 13 [720p].mkv', '1261211'), ('[HorribleSubs] Gundam Build Divers Re-RISE - 19 [720p].mkv', '1261134'), ('[HorribleSubs] Re Zero kara Hajimeru Isekai Seikatsu - 26 [720p].mkv', '1260916'), ('[HorribleSubs] Deca-Dence - 01 [720p].mkv', '1260914'), ('[HorribleSubs] Ahiru no Sora - 38 [720p].mkv', '1260868'), ('[HorribleSubs] Umayon- 01 [720p].mkv', '1260739'), ('[HorribleSubs] Muhyo to Rouji no Mahouritsu Soudan Jimusho - 13 [720p].mkv', '1260704'), ('[HorribleSubs] Black Clover - 133 [720p].mkv', '1260624'), ('[HorribleSubs] Shadowverse - 13 [720p].mkv', '1260599'), ('[HorribleSubs] Fruits Basket S2 (2019) - 14 [720p].mkv', '1260364'), ('[HorribleSubs] The God of High School - 01 [720p].mkv', '1260305'), ('[HorribleSubs] Boruto - Naruto Next Generations - 155 [720p].mkv', '1259986'), ('[HorribleSubs] Healin Good Precure - 14 [720p].mkv', '1259930'), ('[HorribleSubs] Digimon Adventure (2020) - 05 [720p].mkv', '1259914'), ('[HorribleSubs] One Piece - 931 [720p].mkv', '1259902'), ('[HorribleSubs] Maou Gakuin no Futekigousha - 01 [720p].mkv', '1259804'), ('[HorribleSubs] Lapis ReLiGHTs - 01 [720p].mkv', '1259766'), ('[HorribleSubs] Detective Conan - 975 [720p].mkv', '1259710'), ('[HorribleSubs] Healin Good Precure - 13 [720p].mkv', '1259627'), ('[HorribleSubs] Dokyuu Hentai HxEros - 01 [720p].mkv', '1259573'), ('[HorribleSubs] Enen no Shouboutai S2 - 01 [720p].mkv', '1259572'), ('[HorribleSubs] Bungo to Alchemist - Shinpan no Haguruma - 08 [720p].mkv','1259513'), ('[HorribleSubs] Ahiru no Sora - 37 [720p].mkv', '1259098'), ('[HorribleSubs] Fruits Basket S2 (2019) - 13 [720p].mkv', '1258748'), ('[HorribleSubs] Princess Connect! Re Dive - 13 [720p].mkv', '1258716'), ('[HorribleSubs] Kitsutsuki Tanteidokoro - 12 [720p].mkv', '1258672'), ('[HorribleSubs] Gleipnir - 13 [720p].mkv', '1258459'), ('[HorribleSubs] Shachou, Battle no Jikan desu! - 12 [720p].mkv', '1258436'), ('[HorribleSubs] Digimon Adventure (2020) - 04 [720p].mkv', '1258299'), ('[HorribleSubs] One Piece - 930 [720p].mkv', '1258290'), ('[HorribleSubs] Kaguya-sama wa Kokurasetai S2 - 12 [720p].mkv', '1258161'), ('[HorribleSubs] Zashiki Warashi no Tatami-chan - 12 [720p].mkv', '1257794'), ('[HorribleSubs] Plunderer - 24 [720p].mkv', '1257426'), ('[HorribleSubs] Tower of God - 13 [720p].mkv', '1257383'), ('[HorribleSubs] Shadowverse - 12 [720p].mkv', '1257159'), ('[HorribleSubs] A3! Season Spring & Summer - 12 [720p].mkv', '1257006'), ('[HorribleSubs] Fruits Basket S2 (2019) - 12 [720p].mkv', '1256968'), ('[HorribleSubs] Princess Connect! Re Dive - 12 [720p].mkv', '1256947'), ('[HorribleSubs] Kitsutsuki Tanteidokoro - 11 [720p].mkv', '1256920'), ('[HorribleSubs] Shironeko Project - Zero Chronicle - 12 [720p].mkv', '1256913'), ('[HorribleSubs] Gleipnir - 12 [720p].mkv', '1256596'), ('[HorribleSubs] Shachou, Battle no Jikan desu! - 11 [720p].mkv', '1256587'), ('[HorribleSubs] Tsugumomo S2 - 12 [720p].mkv', '1256570'), ('[HorribleSubs] Honzuki no Gekokujou - 26 [720p].mkv', '1256351'), ('[HorribleSubs] Yesterday wo Utatte - 12 [720p].mkv', '1256334'), ('[HorribleSubs] Hamefura - 12 [720p].mkv', '1256323'), ('[HorribleSubs] Kaguya-sama wa Kokurasetai S2 - 11 [720p].mkv', '1256299'), ('[HorribleSubs] Arte - 12 [720p].mkv', '1256278'), ('[HorribleSubs] Nami yoKiitekure - 12 [720p].mkv', '1256078'), ('[HorribleSubs] Listeners - 12 [720p].mkv', '1256074'), ('[HorribleSubs] Sakura Wars the Animation - 12 [720p].mkv', '1255993'), ('[HorribleSubs] Zashiki Warashi no Tatami-chan - 11 [720p].mkv', '1255974'), ('[HorribleSubs] Kakushigoto - 12 [720p].mkv', '1255808'), ('[HorribleSubs] Hachi-nan tte, Sore wa Nai deshou! - 12 [720p].mkv', '1255787'), ('[HorribleSubs] Plunderer - 23 [720p].mkv', '1255619'), ('[HorribleSubs] Tower of God - 12 [720p].mkv', '1255576'), ('[HorribleSubs] Tamayomi - 12 [720p].mkv', '1255565'), ('[HorribleSubs] Ahiru no Sora - 36 [720p].mkv', '1255530'), ('[HorribleSubs] Shadowverse- 11 [720p].mkv', '1255333'), ('[HorribleSubs] A3! Season Spring & Summer - 11 [720p].mkv', '1255218'), ('[HorribleSubs] Fruits Basket S2 (2019) - 11 [720p].mkv','1255176'), ('[HorribleSubs] Princess Connect! Re Dive - 11 [720p].mkv', '1255153'), ('[HorribleSubs] Kitsutsuki Tanteidokoro - 10 [720p].mkv', '1255133'), ('[HorribleSubs] Shironeko Project - Zero Chronicle - 11 [720p].mkv', '1255119'), ('[HorribleSubs] Gleipnir - 11 [720p].mkv', '1254924'), ('[HorribleSubs] Tsugumomo S2 -11 [720p].mkv', '1254893'), ('[HorribleSubs] Honzuki no Gekokujou - 25 [720p].mkv', '1254666'), ('[HorribleSubs] Yesterday wo Utatte - 11 [720p].mkv', '1254649'),('[HorribleSubs] Hamefura - 11 [720p].mkv', '1254633'), ('[HorribleSubs] Kaguya-sama wa Kokurasetai S2 - 10 [720p].mkv', '1254615'), ('[HorribleSubs] Arte - 11 [720p].mkv', '1254584'), ('[HorribleSubs] Major 2nd S2 - 07 [720p].mkv', '1254533'), ('[HorribleSubs] Nami yo Kiitekure - 11 [720p].mkv', '1254362'), ('[HorribleSubs] Listeners - 11 [720p].mkv', '1254353'), ('[HorribleSubs] Sakura Wars the Animation - 11 [720p].mkv', '1254312'), ('[HorribleSubs] Zashiki Warashi no Tatami-chan - 10 [720p].mkv', '1254278'), ('[HorribleSubs] Kakushigoto - 11 [720p].mkv', '1254067'), ('[HorribleSubs] Hachi-nan tte, Sore wa Nai deshou! - 11 [720p].mkv', '1254027'), ('[HorribleSubs] Tower of God - 11 [720p].mkv', '1253843'), ('[HorribleSubs] Plunderer - 22 [720p].mkv', '1253813'), ('[HorribleSubs] Tamayomi - 11 [720p].mkv', '1253759'), ('[HorribleSubs] Ahiru no Sora - 35 [720p].mkv', '1253713'), ('[HorribleSubs] Shadowverse - 10 [720p].mkv', '1253506'), ('[HorribleSubs] A3! Season Spring & Summer - 10 [720p].mkv', '1253403'), ('[HorribleSubs] Fruits Basket S2 (2019) - 10 [720p].mkv', '1253351'), ('[HorribleSubs] Princess Connect! Re Dive - 10 [720p].mkv', '1253330'), ('[HorribleSubs] Kitsutsuki Tanteidokoro - 09 [720p].mkv', '1253291'), ('[HorribleSubs] Shironeko Project - Zero Chronicle - 10 [720p].mkv', '1253284'), ('[HorribleSubs] Hatena Illusion - 12 [720p].mkv', '1253144'), ('[HorribleSubs] Gleipnir - 10 [720p].mkv', '1253092'), ('[HorribleSubs] Shachou, Battle no Jikan desu! - 10 [720p].mkv', '1253073'), ('[HorribleSubs] Tsugumomo S2 - 10 [720p].mkv', '1253051'), ('[HorribleSubs] Honzuki no Gekokujou - 24 [720p].mkv', '1252842'), ('[HorribleSubs] Yesterday wo Utatte - 10 [720p].mkv', '1252820'), ('[HorribleSubs] Hamefura - 10 [720p].mkv', '1252804'), ('[HorribleSubs] Kaguya-sama wa Kokurasetai S2 - 09 [720p].mkv', '1252772'), ('[HorribleSubs] Arte - 10 [720p].mkv', '1252743'), ('[HorribleSubs] Major 2nd S2 - 06 [720p].mkv', '1252716'), ('[HorribleSubs] Nami yo Kiitekure - 10 [720p].mkv', '1252533'), ('[HorribleSubs] Listeners - 10 [720p].mkv', '1252528'), ('[HorribleSubs] Sakura Wars the Animation - 10 [720p].mkv', '1252479'), ('[HorribleSubs] Zashiki Warashi no Tatami-chan - 09 [720p].mkv', '1252443'), ('[HorribleSubs] Kakushigoto - 10 [720p].mkv', '1252243'), ('[HorribleSubs] Hachi-nan tte, Sore wa Nai deshou! - 10 [720p].mkv', '1252225'), ('[HorribleSubs] Plunderer - 21 [720p].mkv', '1252035'), ('[HorribleSubs] Tower of God - 10 [720p].mkv', '1251989'), ('[HorribleSubs] Tamayomi - 10 [720p].mkv', '1251978'), ('[HorribleSubs] Ahiru no Sora - 34 [720p].mkv', '1251940'),('[HorribleSubs] Shadowverse - 09 [720p].mkv', '1251728'), ('[HorribleSubs] A3! Season Spring & Summer - 09 [720p].mkv', '1251623'), ('[HorribleSubs] Shironeko Project - Zero Chronicle - 09 [720p].mkv', '1251620'), ('[HorribleSubs] Fruits Basket S2 (2019) - 09 [720p].mkv', '1251559'), ('[HorribleSubs] Princess Connect! Re Dive - 09 [720p].mkv', '1251544'), ('[HorribleSubs] Kitsutsuki Tanteidokoro - 08 [720p].mkv', '1251506'), ('[HorribleSubs] Gleipnir - 09 [720p].mkv', '1251271'), ('[HorribleSubs] Shachou, Battle no Jikan desu! - 09 [720p].mkv', '1251257'), ('[HorribleSubs] Tsugumomo S2 - 09 [720p].mkv', '1251233'), ('[HorribleSubs] Honzuki noGekokujou - 23 [720p].mkv', '1251060'), ('[HorribleSubs] Yesterday wo Utatte - 09 [720p].mkv', '1251056'), ('[HorribleSubs] Hamefura - 09 [720p].mkv', '1251052'),('[HorribleSubs] Major 2nd S2 - 05 [720p].mkv', '1251049'), ('[HorribleSubs] Kaguya-sama wa Kokurasetai S2 - 08 [720p].mkv', '1250972'), ('[HorribleSubs] Arte - 09 [720p].mkv', '1250953'), ('[HorribleSubs] Nami yo Kiitekure - 09 [720p].mkv', '1250756'), ('[HorribleSubs] Listeners - 09 [720p].mkv', '1250752'), ('[HorribleSubs] Bungo to Alchemist - Shinpan no Haguruma - 07 [720p].mkv', '1250735'), ('[HorribleSubs] Sakura Wars the Animation - 09 [720p].mkv', '1250707'), ('[HorribleSubs]Zashiki Warashi no Tatami-chan - 08 [720p].mkv', '1250669'), ('[HorribleSubs] Kakushigoto - 09 [720p].mkv', '1250466'), ('[HorribleSubs] Hachi-nan tte, Sore wa Nai deshou! - 09 [720p].mkv', '1250445'), ('[HorribleSubs] Plunderer - 20 [720p].mkv', '1250261')]
ANIME_DOWNLOAD_PATH = "D:\Anime"


@app.route('/')
def index():
    return render_template("index.html")


@app.route('/add-anime', methods=("GET", "POST"))
def add_anime_page():
    form = forms.AddAnimeForm()
    if form.validate_on_submit():
        anime_name = request.form.get("anime_name")
        current_episode = int(request.form.get("current_episode"))
        total_episodes = int(request.form.get("total_episodes"))
        # TODO: Add form validation.

        if add_anime_to_database(anime_name, current_episode, total_episodes):
            return render_template("add_anime.html", form=form, anime_name=form.anime_name.data)
        else:
            pass
            # TODO: Show error message.

    return render_template("add_anime.html", form=form)


@app.route('/update-anime', methods=("GET", "POST"))
def update_anime_page():
    form = forms.AddAnimeForm()
    all_anime = get_all_anime_from_database()

    if request.method == "POST":
        anime_id = int(request.form["anime-id"])
        current_episode = int(request.form.get(f"current-episode-{anime_id}"))  # As we have to get the data from the input field of that particular anime.
        total_episodes = int(request.form.get(f"total-episodes-{anime_id}"))

        if update_anime_in_database(anime_id, current_episode, total_episodes):
            return render_template("update_anime.html", form=form, all_anime=all_anime, success=True)

    return render_template("update_anime.html", form=form, all_anime=all_anime)


@app.route('/all-anime')
def all_anime_page():
    all_anime = get_all_anime_from_database()

    return render_template("all_anime.html", all_anime=all_anime)


@app.route('/check-anime', methods=("GET", "POST"))
def check_new_anime():
    if request.method == 'POST':
        # horriblesubs_data = scrape_data()
        horriblesubs_data = TEMP_SITE_DATA

        new_episodes, anime_id_mapping = check_new_episodes(horriblesubs_data)
        if request.form.get("check_anime_button", None) == "Click here to check":
            return render_template("check_anime.html", data=new_episodes)

        elif request.form.get("download-button", None):
            anime_name = request.form.get("download-button")
            already_downloaded_anime = os.listdir(ANIME_DOWNLOAD_PATH)
            latest_episode_number = 0

            for row in new_episodes[anime_name]:                # row format: ('<anime name>', 7, '1271478')
                if f"[HorribleSubs] {row[0]} - {row[1] if row[1] > 10 else '0' + str(row[1])} [720p].mkv" not in already_downloaded_anime:
                    download_torrent(f"https://nyaa.si/download/{row[-1]}.torrent")
                    if add_torrent(f"{row[-1]}.torrent"):
                        latest_episode_number = max(latest_episode_number, row[1])
                    else:
                        print("Couldn't add torrent!")
                    os.remove(f"{row[-1]}.torrent")

            update_anime_in_database(anime_id_mapping[anime_name], latest_episode_number)
            del new_episodes[anime_name]

            return render_template("check_anime.html", data=new_episodes)
    return render_template("check_anime.html")


@app.route('/delete-anime', methods=("GET", "POST"))
def delete_anime():
    form = forms.AddAnimeForm()
    all_anime = get_all_anime_from_database()

    if request.method == "POST":
        anime_id = int(request.form['anime-id'])

        if delete_anime_from_database(anime_id):
            all_anime = get_all_anime_from_database()
            return render_template("delete_anime.html", form=form, all_anime=all_anime, success=True)

    return render_template("delete_anime.html", form=form, all_anime=all_anime)


